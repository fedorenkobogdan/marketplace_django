{% extends 'base.html' %}
{% load static %}
{% load widget_tweaks %}

{% block title %}{{ product.name }}{% endblock %}

{% block content %}
<div class="container">
  <div class="row g-4">
    <!-- üñº –§–æ—Ç–æ —Ç–æ–≤–∞—Ä—É -->
    <div class="col-md-6">
      {% if images %}
        <div id="productCarousel" class="carousel slide" data-bs-ride="carousel">
          
          {% if images|length > 1 %}
            <div class="carousel-indicators">
              {% for image in images %}
                <button type="button" data-bs-target="#productCarousel" data-bs-slide-to="{{ forloop.counter0 }}"
                        class="{% if forloop.first %}active{% endif %}" aria-current="true"
                        aria-label="–°–ª–∞–π–¥ {{ forloop.counter }}"></button>
              {% endfor %}
            </div>
          {% endif %}

          <div class="carousel-inner">
            {% for image in images %}
              <div class="carousel-item {% if forloop.first %}active{% endif %}">
                <img src="{{ image.image.url }}" class="d-block w-100 rounded shadow-sm" alt="{{ product.name }}"
                     style="max-height: 450px; object-fit: contain;">
              </div>
            {% endfor %}
          </div>

          {% if images|length > 1 %}
            <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel" data-bs-slide="prev">
              <span class="carousel-control-prev-icon"></span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#productCarousel" data-bs-slide="next">
              <span class="carousel-control-next-icon"></span>
            </button>
          {% endif %}
        </div>
      {% else %}
        <img src="{% static 'products/no-image.png' %}" class="img-fluid rounded shadow-sm" alt="–ë–µ–∑ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è">
      {% endif %}
    </div>

    <!-- ‚ÑπÔ∏è –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Ç–æ–≤–∞—Ä -->
    <div class="col-md-6">
      <h2>{{ product.name }}</h2>
      <p class="text-muted">{{ product.description }}</p>
      <p class="fw-bold fs-4 text-success">{{ product.price }} –≥—Ä–Ω</p>

      {% if product.category %}
        <p>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è: <span class="badge bg-secondary">{{ product.category.name }}</span></p>
      {% endif %}

      <p>–ü—Ä–æ–¥–∞–≤–µ—Ü—å: <strong>{{ product.author.username }}</strong></p>

      <form action="{% url 'add_to_cart' product.pk %}" method="post">
        {% csrf_token %}
        <button type="submit" class="btn btn-primary btn-lg mt-3">üõí –î–æ–¥–∞—Ç–∏ –≤ –∫–æ—à–∏–∫</button>
      </form>

      {% if user == product.author %}
        <div class="mt-3 d-flex gap-2">
          <a href="{% url 'product_update' product.pk %}" class="btn btn-outline-warning btn-sm">‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏</a>
          <a href="{% url 'product_delete' product.pk %}" class="btn btn-outline-danger btn-sm">üóë –í–∏–¥–∞–ª–∏—Ç–∏</a>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- üí¨ –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ -->
  <div class="mt-5">
    <h5>üí¨ –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ</h5>

    {% if comments %}
      <ul class="list-group mb-4">
        {% for comment in comments %}
          <li class="list-group-item">
            <strong>{{ comment.author.username }}</strong> ‚Äî 
            <small class="text-muted">{{ comment.created_at|date:"d.m.Y H:i" }}</small>
            <p class="mb-0">{{ comment.content }}</p>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="text-muted">–ù–µ–º–∞—î –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤.</p>
    {% endif %}

    {% if user.is_authenticated %}
      <form method="post" class="mt-3">
        {% csrf_token %}
        {{ comment_form.content|attr:"placeholder:–í–∞—à –∫–æ–º–µ–Ω—Ç–∞—Ä..."|add_class:"form-control" }}
        <button type="submit" class="btn btn-outline-primary mt-2">üí¨ –ó–∞–ª–∏—à–∏—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä</button>
      </form>
    {% else %}
      <p>–©–æ–± –∑–∞–ª–∏—à–∏—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä, <a href="{% url 'login' %}">—É–≤—ñ–π–¥—ñ—Ç—å</a>.</p>
    {% endif %}
  </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
  textarea {
    width: 100%;
    min-height: 100px;
    resize: vertical;
  }
</style>
{% endblock %}

























