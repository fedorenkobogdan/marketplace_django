{% extends 'base.html' %}
{% load static %}
{% load widget_tweaks %}  {# ‚¨ÖÔ∏è –î–æ–¥–∞–Ω–æ –¥–ª—è —Ä–æ–±–æ—Ç–∏ add_class #}

{% block title %}{{ product.name|default:"–ù–æ–≤–∏–π —Ç–æ–≤–∞—Ä" }}{% endblock %}

{% block content %}
<div class="container">
  <h2 class="mb-4">{{ product.name|default:"üìù –î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä" }}</h2>

  <form method="post" enctype="multipart/form-data" class="p-4 bg-white shadow rounded-3">
    {% csrf_token %}

    <!-- üî¥ –ó–∞–≥–∞–ª—å–Ω—ñ –ø–æ–º–∏–ª–∫–∏ -->
    {% if form.non_field_errors %}
      <div class="alert alert-danger">
        {{ form.non_field_errors }}
      </div>
    {% endif %}

    <!-- üîß –ü–æ–ª—è —Ñ–æ—Ä–º–∏ -->
    <div class="row g-3">
      <div class="col-md-6">
        <label class="form-label" for="{{ form.name.id_for_label }}">–ù–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä—É:</label>
        {{ form.name|add_class:"form-control" }}
      </div>

      <div class="col-md-6">
        <label class="form-label" for="{{ form.category.id_for_label }}">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è:</label>
        {{ form.category|add_class:"form-select" }}
      </div>

      <div class="col-md-12">
        <label class="form-label" for="{{ form.description.id_for_label }}">–û–ø–∏—Å:</label>
        {{ form.description|add_class:"form-control" }}
      </div>

      <div class="col-md-4">
        <label class="form-label" for="{{ form.price.id_for_label }}">–¶—ñ–Ω–∞ (–≥—Ä–Ω):</label>
        {{ form.price|add_class:"form-control" }}
      </div>

      <div class="col-md-8">
        <label class="form-label" for="{{ form.image.id_for_label }}">–ì–æ–ª–æ–≤–Ω–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è:</label>
        {{ form.image|add_class:"form-control" }}
      </div>

      <!-- üìé –î–æ–¥–∞—Ç–∫–æ–≤—ñ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è -->
      <div class="col-md-12">
        <label for="id_images" class="form-label">üì∏ –î–æ–¥–∞—Ç–∫–æ–≤—ñ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è:</label>
        <input type="file" name="images" id="id_images" multiple class="form-control">
        <small class="text-muted">–ú–æ–∂–Ω–∞ –≤–∏–±—Ä–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ —Ñ–∞–π–ª—ñ–≤ (Ctrl –∞–±–æ Shift).</small>
      </div>
    </div>

    <!-- üñº –Ü—Å–Ω—É—é—á—ñ —Ñ–æ—Ç–æ -->
    {% if product and product.productimage_set.exists %}
      <div class="mt-4">
        <label class="form-label">üñº –î–æ–¥–∞–Ω—ñ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è:</label>
        <div class="d-flex flex-wrap gap-3">
          {% for image in product.productimage_set.all %}
            <div class="position-relative">
              <img src="{{ image.image.url }}" class="border rounded" style="width: 120px; height: 120px; object-fit: cover;" alt="–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è">
              <a href="{% url 'product_image_delete' image.pk %}" 
                 class="btn btn-sm btn-danger position-absolute top-0 end-0" 
                 onclick="return confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è?');">√ó</a>
            </div>
          {% endfor %}
        </div>
      </div>
    {% endif %}

    <!-- ‚úÖ –ö–Ω–æ–ø–∫–∏ -->
    <div class="mt-4 d-flex gap-2">
      <button type="submit" class="btn btn-success">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏</button>
      <a href="{% url 'product_list' %}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥</a>
    </div>
  </form>
</div>
{% endblock %}








